const input = `\\-..../................\\...../....|....|...........\\...........\\....../././............../...........|........
....\\.................\\........./..........................................-..|.........../..../.........../..
.|./........................./..........-.....|..../......../.........|......../.....|.................-....-.
.--...............-.|........................\\.......\\...........|..........\\.................................
............|......|.........|.......\\..\\..../............./....-.../.........././............\\.......\\.......
..|\\.....|................/...........\\.\\....\\\\........\\.........\\..........|.......|...\\.-....-.......|./....
.........................../................................../../..|....../\\........\\................/...../.
.../.......|./-..\\....................................../....../...........-.....|.....|....../...............
...-...\\......-.........../..../.......\\\\..............-\\....../....................|.....|...........\\.......
.|............-......../...........|........|...........-/.-..........\\..............-..|............|-.......
.................\\/.........\\/..../........./......../.-\\........\\..-.......|..............|..\\..............|
......./|../..........\\/.............-........|........................\\.................................-....
....../......................................./.................--.....-.|......................\\..../........
.\\.................|............|.//....|/.............|...........\\|..........-..........-................-..
.../................|........|...-.................\\....|....|....|..............................|............
|.........-\\...-.-......./.............-.-/...............-.\\..../........................./.........\\....\\...
......|........./............\\.../\\.....-...|...............\\.....|................................\\..........
.........................................\\......\\.........................-......\\...-......../......./\\-./...
....../.../......-..................................................../|.......|........................\\.....
....................../\\/..........................|.......................................|..................
|.......\\.......................|..-..\\......\\..\\...............................................|.......|.....
................../........-...|..........................|............-........\\.......|...........\\.........
.............................|.............../.......\\....|......................./............./......./..../
.\\.............-..-...|...-.-....|......./.........../...../........./....................\\././.....|.........
..-..../....\\......................|............................................./.\\.../..........|...........
....-.........-.......\\......-.............../.............|....|......./.......\\..-.\\.....\\..-...............
..................../-.......|..../....-/...|...........-//..............-./...........-...........././.......
..............................................|.-........|...........\\..|/|..-.....-...../......../...........
...............................\\.../-..|......|......./.\\................--............-........../.....\\./...
-.............|.-......................................................|.....\\.|....-.....|......\\|........\\..
-....\\.....-...-.............../...........-.................................../.|.\\........-.................
....-....\\.-./.../..../........\\..-.............|...................|.........\\.....\\................../..\\|..
...................||..|.......|.....\\.../.....-../.....-.|............/.......-.........|........./..-......|
.........\\........-....-..-.....|..............|.........-.\\|.\\|.........\\....|.........\\.\\\\...........|.\\.|..
..........................|..|.../../...-...............-....../....................|...............-.........
...../|........|./..................-....\\.|...........|..............................\\./.../\\................
............................../..\\..\\............-.../.........-...../.......-..\\...|....../..-|-.............
..........-...../.......-................-...........|..\\|..|.\\.............../.-.../.........................
............................../..-.....-...../............................\\........|...................\\......
/./.......-|...-...\\/.......-................/.....-....\\...../..............\\../............-................
.............\\...........................-...|................................\\./..-............-........|/|./
......................./..-.......\\........./...\\..|..../.....................-.....-\\|...................../.
.....|...-....-..-/....|.|................................../............/............./..\\........./.....-...
.....|................\\.../.....\\..........................\\|...........-.\\.|./..-.....\\....../....\\....|.....
......................\\................-............../\\....||....-...-.....|......|-.......................-.
.................................|..........-......|.....-......-........|.|...../.........-......\\..../|.....
................../.......\\.....................................|......................................-......
......\\.....\\..../..-................-......................-..................................-...--.-.-.....
...........-...........\\.............................................................-.-........-.............
.|..............\\./........................../................./..-....-........|-/.../.......-........\\......
.-...-/...|.|.../..-........../..............................|.../..........\\.............-.............../.|.
.............\\..|.....\\.....\\.................-....\\...................|../.-......|.......\\..\\.../....../....
/........|....\\.........\\.....|..........\\./..\\.........-.-.......-.....|....../.......\\-\\..-..../............
..........|...|\\...|............\\......\\.............-.|...........-.....................|..................\\-
............\\.\\...../../..........................-.|...................../........\\..-....-............/.....
............./.../|...\\.......-...................\\....|....-\\..........|/.-//.\\.......\\..-.\\.....\\...\\../....
.-..............|.....|.........|......|\\................//...|...........................\\...\\...-...........
......-...\\../...........................|...............\\.||.........................-..............-........
.......-............|...|....-...\\....|...|........|..../........................................|.........\\..
........\\.|.\\....\\.\\.|...........|......./.....................\\.../.............-...|./...........\\..........
........./......-.........-................|.../...............-.............../|\\..........-./...............
...\\..........\\......./........\\........./.../........../........-......-........-......................./....
............./../........../.........../................-...............-./....-............................-.
..\\/.|....................|.....\\................-...............--...................../............./.......
.............................-....-........................................................|..........|..|....
./................................/............../..................................................|..\\.../..
...............-...............|...............................-.../.-.|..-........../.../....................
.......|...\\.............\\...\\./................-......\\..\\././........-.............../.................../..
..../..\\...-..............|./........../....../...../........\\....../......-....../..|......-.................
.............................--./..........-....\\...........|.............................../.................
.........../...............-....-|......./..........-..|.....................-......\\.\\.................../...
.-.|...-.\\................/../......\\...........|.......-...........-.........................................
./........\\-........../..........././.............|...\\................-............|....................|....
.........|..\\||............|.-..\\.................-.....-.......-..|...........\\................|......../....
....-.................\\...-......\\.........|...........\\...../.....\\.......-....................|/......-.....
......-...|...........\\.....-....................-.........../.....\\...\\......................................
../.....\\....|..-..\\.............../..........................|..\\-.\\........................|....\\....-.\\..|.
/--....|.../.........\\./.................|..-.........|....-..............................-.-../..............
.\\...............//......-........./.....................................\\|...\\......|.............../........
..........................\\.........\\..................\\..................\\.................-...|./...........
.......--................../........................|........................\\..........|.....................
.........-............................-./......./.|..................|.........\\...............|..............
...../..\\................../...-.....|...........\\|.......|...........\\........./..|....-...........-.........
....-.....\\..................|......\\.../...\\........./.....\\..............................\\./................
.\\.......\\......|......|...................\\.....-../...........................-.....-...........-/..........
.....\\........./......./..\\....................../../.......-....../.....|.........-........|.....|\\/.........
........................\\........./....................../../............-.........\\........|\\......\\-......\\.
..........................-./.....\\../..\\........./..............\\.........\\.......|...../......|.........../.
........................|......-\\...-..........|.......................-../.....|..-......................|...
.....//.../......................\\...\\............................................./..\\.|....../..........|...
-...\\.|.../....................................\\..................-.-...|..|................-..|......|.....|.
.....\\..-.......................|...|..............\\.......\\..........\\....-../......................|.-......
/\\.....-..\\.........-...|.....|.......\\../../................../.-.....\\......-.|............/.........-......
....................................././............\\........|....|........................../......../....|..
..............|................|....\\........./................||...........|................/-....\\...-......
............/|.....|.........\\..............|.....|........./....|.............../......\\............./..\\....
-...../.....\\.........-...|............./................./........../......./............./.....|........\\...
...|./......................................\\.......|...../............-...............\\.././...\\.............
..\\...............\\....../..\\....|............................\\.....|....\\....-...................-...........
..............\\.....\\......./............--..................||.......\\..-../.|.............|....../.-....\\.-.
/..............-.......................-..........................\\............\\....................|........|
......-...................../..............................\\...|.....\\../..............|...|..................
.....-.....\\...../.-........................-.........|..........\\............\\../.......|........./.-.|.....\\
....-................|...././..\\...-......./..../.........-........|/......../..........\\......|/..\\......-...
./...|..\\....|./......\\....../..........-.|..........\\.............-..........\\|.\\............................
.....|..|..../........................../......|./../...-................-|......\\............................
./|......|................|..-.............../\\....-............./-...................-.|.........|..........|
............................................|.\\........-.\\..../..|..................-.........-....-.-./......
...../............................\\...................-.-...-../...........|..|....\\...................-.....\\
......./...\\../..........-.................-.........................-........../...-......\\..................`;

type Point = [number, number];
type Direction = [number, number];

const N: Point = [0, -1];
const E: Point = [1, 0];
const S: Point = [0, 1];
const W: Point = [-1, 0];
const forwardReflect = new Map([[N, E], [E, N], [S, W], [W, S]]);
const backwardReflect = new Map([[N, W], [E, S], [S, E], [W, N]]);

const matrix = input.split('\n').map((line) => line.split(''));
const energized: boolean[][] = new Array(matrix.length).fill(null).map(() => new Array(matrix[0].length).fill(false));
const path: [Point, Direction][] = [[[0, 0], E]];
const travelled: Record<string, boolean> = {};

for (let i = 0; i < path.length; i++) {
  follow(...path[i]);
}

function follow(node: Point, direction: Direction) {
  const char = matrix[node[1]]?.[node[0]];

  if (!char) return;

  const key = `${node.join()}:${direction.join()}`;

  if (travelled[key]) return;

  energized[node[1]][node[0]] = true;
  travelled[key] = true;

  if (char === '/') {
    direction = forwardReflect.get(direction);
  }

  if (char === '\\') {
    direction = backwardReflect.get(direction);
  }

  if (char === '-' && (direction === N || direction === S)) {
    path.push([[node[0] + W[0], node[1] + W[1]], W]);
    path.push([[node[0] + E[0], node[1] + E[1]], E]);

    return;
  }

  if (char === '|' && (direction === W || direction === E)) {
    path.push([[node[0] + N[0], node[1] + N[1]], N]);
    path.push([[node[0] + S[0], node[1] + S[1]], S]);

    return;
  }

  path.push([[node[0] + direction[0], node[1] + direction[1]], direction]);
}

console.log(energized.flat().filter(Boolean).length);

// Answer: 7562
